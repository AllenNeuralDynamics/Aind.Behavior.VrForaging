{
  "$id": "aind-vr-foraging-task",
  "$schema": "https://json-schema.org/draft-09/schema",
  "definitions": {
    "corridorSpecifications": {
      "$ref": "aind-vr-foraging-common.json#/definitions/visualCorridor"
    },
    "siteLabel": {
      "enum": ["Unspecified", "Gap", "InterPatch", "Reward"],
      "type": "string"
    },
    "virtualSite": {
      "$ref": "aind-vr-foraging-common.json#/definitions/virtualSite"
    },
    "reward": {
      "$ref": "aind-vr-foraging-common.json#/definitions/rewardSpecifications"
    },
    "taskStage": {
      "enum": ["Habituation", "Foraging"],
      "default": "Habituation",
      "type": "string"
    },
    "distributionsPackage": {
      "$ref": "dataclasses-distributions.json"
    }
  },
  "properties": {
    "updaters": {
      "type": "object",
      "additionalProperties": { "$ref": "aind-vr-foraging-common.json#/definitions/numericalUpdater"}
    },
    "environmentStatistics": {
      "properties": {
        "patches": {
          "default": [],
          "items": {
            "$ref": "aind-vr-foraging-common.json#/definitions/patchStatistics"
          },
          "type": "array"
        },
        "transitionMatrix": {
          "$ref": "aind-vr-foraging-common.json#/definitions/matrix2d"
        },
        "firstState": {
          "type": ["null", "integer"],
          "default": null
        }
      },
      "type": "object"
    },
    "operationControl": {
      "properties": {
        "movableSpoutControl":{
          "type":"object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "timeToCollectAfterReward": {
              "type": "number",
              "default": 1
            }
          }
        },
        "odorControl": {
          "type": "object",
          "properties": {
            "valveMaxOpenTime": {
              "type": "number",
              "minimum": 0
            },
            "targetTotalFlow": {
              "type": "number",
              "minimum": 100,
              "maximum": 1000,
              "default": 1000
            },
            "useChannel3AsCarrier": {
              "type": "boolean",
              "default": true
            },
            "targetOdorFlow": {
              "type": "number",
              "minimum": 0,
              "maximum": 100,
              "default": 100
            }
          }
        },
        "positionControl": {
          "properties": {
            "gain": {
              "$ref": "aind-vr-foraging-common.json#/definitions/vector3"
            },
            "initialPosition": {
              "$ref": "aind-vr-foraging-common.json#/definitions/vector3"
            },
            "stopResponseConfig": {
              "properties": {
                "frequencyFilterCutoff": {
                  "maximum": 100,
                  "type": "number"
                },
                "velocityThreshold": {
                  "minimum": 1,
                  "type": "number"
                }
              },
              "type": "object"
            }
          },
          "type": "object"
        },
        "taskStage": {
          "$ref": "#/definitions/taskStage"
        },
        "habituationSettings": {
          "type": ["null", "object"],
          "properties": {
            "distanceToReward": {
                "$ref": "aind-vr-foraging-common.json#/definitions/truncatedExponential"
            },
            "reward": {
              "$ref": "#/definitions/reward"
            },
            "contrast": {
              "type": ["number", "null"],
              "default": null
            }
          },
          "default": null,
          "required": ["distanceToReward", "reward"]
        },
        "virtualSiteGeneration": {
          "properties": {
            "gapSite": {
              "properties": {
                "contrast": {
                  "type": ["number", "null"],
                  "default": null
                },
                "label": {
                  "$ref": "#/definitions/siteLabel",
                  "default": "Gap"
                },
                "lengthDistribution": {
                  "$ref": "aind-vr-foraging-common.json#/definitions/truncatedExponential"
                }
              },
              "type": "object"
            },
            "interPatchSite": {
              "properties": {
                "contrast": {
                  "type": ["number", "null"],
                  "default": null
                },
                "label": {
                  "$ref": "#/definitions/siteLabel",
                  "default": "InterPatch"
                },
                "lengthDistribution": {
                  "$ref": "aind-vr-foraging-common.json#/definitions/truncatedExponential"
                }
              },
              "type": "object"
            },
            "rewardSite": {
              "properties": {
                "contrast": {
                  "type": ["number", "null"],
                  "default": null
                },
                "label": {
                  "$ref": "#/definitions/siteLabel",
                  "default": "Reward"
                },
                "lengthDistribution": {
                  "$ref": "aind-vr-foraging-common.json#/definitions/truncatedExponential"
                }
              },
              "type": "object"
            }
          },
          "required": ["interPatchSite", "rewardSite", "gapSite"],
          "default": null,
          "type": ["null", "object"]
        }
      },
      "type": "object",
      "required": ["taskStage", "positionControl", "odorControl"]
    }
  },
  "required": [
    "operationControl",
    "environmentStatistics"
  ],
  "title": "AindVrForagingTask",
  "type": "object"
}
